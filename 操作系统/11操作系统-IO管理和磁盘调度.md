# 操作系统—I/O管理和磁盘调度

> 

## 1. IO设备

1.1 IO设备大致分类：
	* 人可读
	* 机器可读
	* 通信
	
1.2 不同IO设备之间差异大，甚至同一类别不同设备之间也有很大的差异：
	* 数据传输速率
	* 应用
	* 控制的复杂性
	* 传送单位
	* 数据表示
	* 错误条件

## 2.IO功能的组织

> 执行IO的三种技术:
>	1. 程序控制IO
>	2. 中断驱动IO
>	3. 直接存储器访问（DMA）

2.1 IO功能的发展
	* 处理器直接控制外围设备
	* 增加了控制器或IO模块。处理器使用非中断的程序控制IO
	* 中断驱动IO
	* IO模块通过DMA直接控制存储器（DMA）
	* IO模块有一个单独的处理器，有专门为IO设计的指令集。（IO通道）
	* IO模块有自己的局部存储器（IO处理器）

2.2 直接存储器访问，当处理器想读或者写一块数据时，它通过向DMA模块发送以下信息来给DMA模块发出一条命令
	* 请求读或者写的操作，通过控制线发送
	* 相关IO设备的地址，通过数据线传送
	* 从存储器读或向存储器写的起始地址，在数据线上传送，并由DMA模块保存在其地址寄存器中
	* 读或写的字数，通过数据线传送，并由DMA模块保存在其数据寄存器中
	
3.3 DMA的多种配置：
​	![](.\11.01.png)
​	
## 3.操作系统设计的问题

1. 设计目标：
	* 效率：IO操作通常是计算机系统的瓶颈
	* 通用性： 出于简单和避免错误的考虑，人们希望能使用统一的方式处理所有设备
​	
2. IO功能的逻辑结构
	![](.\11.02IO.png)

## 4.IO缓冲

> 问题：用户进程从磁盘上读取512字节到虚拟地址1000-1511中，read_block(1000, disk)，这时用户进程会阻塞，该进程的所在的内存可能被换出到硬盘
>
> 面向块的设备：磁盘
> 面向流的设备：鼠标、终端、打印机、通信端口

1. 单缓冲：



## 5.磁盘调度

1. 磁盘性能参数
	* 寻道时间：
		* 磁头定位到磁道所需的时间。这个时间很难减少
		
	* 旋转延迟：
		* 指将磁盘的待访问区域旋转到读写磁头可访问的位置所需要的时间
		* 平均值：1 / 2r，
		* r表示：每分钟旋转多少转(rpm)
	
	* 存取时间
	
	* 传输时间
		* T = b / rN
		* b传送的字节数
		* N表示一个磁道中的字节数







## 问题
1. 操作系统为什么不在用户空间建立缓冲，而是在内核空间
答：当用户程序发出阻塞读的时候，用户进程被阻塞，这时操作系统可能会把用户程序所在的内存块换出到硬盘，这样传入的数据就不正确了。

















