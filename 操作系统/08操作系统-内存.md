# 操作系统—虚拟内存

> 

## 1. 虚拟内存

1. 系统抖动：
   * 概念： 处理器大部分时间用于交换块，而非执行指令（用户程序）
   * 例子：（大致意思理解到位就行，例子不太准确）
     * 内存不足时，cpu分配给进程A执行，A执行时发现获取的数据没在内存中，发起IO请求，将A的数据调入内存第n页，将A设置为阻塞态，转而执行进程B
     * 执行进程B的时候发现获取的数据没在内存中，发起IO请求，将B的数据调入内存第m页，将B设置为阻塞态，转而去执行进程C
     * 这时候第n页的数据准备完成，将进程A设置为就绪态，继续执行进程C
     * 执行进程C的时候发现获取的数据没在内存中，发起IO请求，将B的数据调入内存第n页，将C设置为阻塞态，转而去执行进程A



## 1.倒排页表

![](E:\学习笔记\操作系统\801倒排页表结构.png)



1. 特点：
   * 倒排页表的表项数 = 物理内存的页框数

2. 进程加载：（个人理解）
   * 虚拟内存第n页的数据要换入内存时，需要经过散列函数计算出物理内存的页框号m，如果页框m没有被使用则使用该页框，并修改倒排页表；如果被其它进程使用，则换入到其它页框，并修改倒排页表的链

3. 逻辑地址转换物理地址：（个人理解）
   * 虚拟地址页号n，通过散列函数计算出页框号i（这时的i就可以定位出物理内存的一个地址），但是还需要取倒排页表比较虚拟地址的页号和倒排页表中的页号是否相等，相等则取该页框号i，不相等则根据是否有链，通过链再去寻找页框号j



2. 放置策略
   * 非一致性存储访问：https://cloud.tencent.com/developer/article/1357891



## 问题

1. 内存分页后，一个进程在多个页框中， 这时一个程序在页框1中执行，cpu的基地址是页1在内存中的偏移地址，需要执行jmp到另一个页框5中，这时的逻辑地址到物理地址的映射是怎么完成的？
    答： 也是需要硬件提供支持，逻辑地址到物理地址转换的时候，处理器必须知道如何访问进程的页表

2. 使用了分页技术后，在汇编中执行一条传送指令，如mov ax, ds:[0]，会涉及到2次内存访问，第一次是将数据所在的逻辑地址ds:[0]转换为物理地址，第二次是将该物理地址的数据传送到ax寄存器

3. 置换策略：最佳OPT策略是，选择置换下次访问距当前时间最长的那些页，程序运行时我怎么知道下次要访问哪些页？

   答：不可能实现，可用于衡量其它算法性能的标准

4. 在置换策略中，怎么确定被置换的页是否被修改过？也是硬件支持吗？