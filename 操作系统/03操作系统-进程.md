# 操作系统—进程

## 1.什么是进程

1. 概念：
	* 进程是现代计算机操作系统中，用于控制用户程序的调度构建的一个模型（个人理解）
	* 可把进程视为由一组元素组组成的实体
	* 一个正在执行的程序

2. 进程的基本元素：
	* 程序代码
	* 与代码相关的【数据集】

3. 进程的要素，当一个程序执行时，进程可以被以下元素唯一的表征（描述）：
	* 标志符
	* 状态：进程处于的运行态
	* 优先级
	* 程序计数器：程序中即将执行的下一条指令的地址。（如：8086 cpu中的cs、ip寄存器）
	* 内存指针：包括程序代码和进程相关数据的指针，以及与其他进程共享内存块的指针
	* 上下文数据：进程执行时处理器的寄存器中的数据。（用于保存进程在切出的时候寄存器中的数据，方便在进程运行的时候恢复寄存器的数据）
	* I/O状态信息：显示IO请求、分配给进程的IO设备、被进程使用的文件列表等
	* 记账信息：包括处理器时间总和、使用的时钟数总和、时间限制、记账信心等（？？？？没理解）

## 2.进程的状态

轨迹：
 *  通过列出为该进程执行的指令序列来描述单个进程的行为
*  可以通过给出各个进程的轨迹是如何被交替的来描述处理器的行为

调度器：

* 使处理器从一个进程切换到另一个进程的小程序

进程的执行顺序：

* 进程A -> 调度器 -> 进程B -> 调度器 -> 进程C


### 2.1两状态进程模型

![](.\301两状态进程模型.png)

### 2.2进程的创建和终止

1. 进程创建的原因

| 事件                         | 说明                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| 新的批处理作业               | 通常位于于磁带或磁盘中的批处理作业控制流被提供给操作系统。当操作系统准备接受新工作时，它将读取下一个作业控制命令 |
| 交互登录                     | 终端用户登录到系统                                           |
| 操作系统为提供一项服务而创建 | 操作系统可以创建一个进程来代表用户程序执行一个功能，使用户无需等待（例如控制打印的进程） |
| 由现有的进程派生             | 为了模块化或是利用并行性，一个用户程序可以指示创建多个进程   |

2. 进程终止的原因

| 事件             | 说明                                                         |
| ---------------- | :----------------------------------------------------------- |
| 正常完成         | 执行一个操作系统服务调用来表示它已经结束运行                 |
| 超出时限         | 进程运行时间超过规定的时限。<br />可以测量很多种类型的时间，包括总的运行时间（“挂钟时间”），执行所花费的时间，<br />以及对于交互进程从上一次用户输入到当前时刻的时间 |
| 无可用内存       | 系统无法满足进程需要的内存空间                               |
| 越界             | 进程试图访问不允许访问的内存单元                             |
| 保护错误         | 进程试图使用不允许使用的资源，比如文件，或者试图以一种不正确的方式使用，比如往只读文件中写入 |
| 算数错误         | 进程试图进行被禁止的计算，例如除以零或者存储大于硬盘可以接纳的数字 |
| 时间超出         | 进程等待某一事件发生的时间超过了规定的最大值                 |
| I/O失败          | 在输入或输出期间发生错误，例如找不到文件、尝试超过最大次数后仍然读写失败（例如当遇到磁带上的一个坏区时），或者无交往操作（如从行式打印机中读取） |
| 无效指令         | 进程试图执行一个不存在的指令（通常是由于转移到数据区并企图执行数据） |
| 特权指令         | 进程试图执行一个为操作系统保留的指令                         |
| 数据误用         | 错误类型或者没有初始化的一块数据                             |
| 操作员或系统干涉 | 操作员或操作系统出于某些原因终止进程（例如，如果存在死锁）   |
| 父进程终止       | 当一个父进程终止了，操作系统可能会自动终止这个父进程所有的后代进程 |
| 父进程请求       | 父进程通常具有终止其任何后代的权利                           |

### 2.3五状态模型

![](E:\学习笔记\操作系统\302五状态进程模型.png)

![](E:\学习笔记\操作系统\303五状态进程排队模型.png)

### 2.4被挂起的进程

![](E:\学习笔记\操作系统\304挂起状态模型.png)

## 3.进程的描述

> 为了管理和进程和资源，必须掌握每个进程和资源的当前状态。操作系统维护的四种不同类型的表：内存、I/O、文件和进程

1. 内存表
   * 用于跟踪内（实）存和外（虚）存
2. I/O表
   * 管理计算机系统中的I/O设备和通道
3. 文件表
4. 进程表

### 3.1进程的控制结构

> 操作系统要管理控制进程，需要知道【进程位置】（如：内/外存上的位置）、【进程属性】（如：进程id、状态）

1. 进程运行必要的要素有以下这些，这些被称为【进程映像】

   * 用户程序
   * 用户数据
   * 栈
   * 进程控制块：方便操作系统控制需要的属性

   

2. 进程映像的位置取决于所用的内存管理方案

   

3. 进程控制块中的典型元素：

   * 进程标志信息
     * 标志符：该进程的标志符、父进程标志符、用户标志符
   * 处理器状态信息
     * 用户可见寄存器
     * 控制和状态寄存器：各种寄存器，程序计数器、条件码、状态信息
     * 栈指针
   * 进程控制信息
     * 调度和状态信息：进程状态、优先级、调度相关信息、事件（进程继续执行前等待的事件标志）
     * 数据结构
     * 进程间通讯
     * 进程特权
     * 存储管理
     * 资源所有权和使用情况

4. 进程映像在虚存中的结构

![](E:\学习笔记\操作系统\305虚存中的用户进程.png)

## 4.进程控制

1. 执行模式：
   * 用户模式
   * 特权模式，又称：系统模式、控制模式、内核模式


