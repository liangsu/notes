# Redis是如何淘汰key的

## 1. 淘汰原理

1. 淘汰时机：当 key 过期后，或者 Redis 实际占用的内存超过阀值后
2. 淘汰方式：
   * 定期执行 serverCron ，检查淘汰 key
   * 执行命令时，检查淘汰 key
3. 定期执行 serverCron ，的清理流程：
   * 首先轮询每个 DB，检查其 expire dict，即带过期时间的过期 key 字典，从所有带过期时间的 key 中，随机选取 20 个样本 key，检查这些 key 是否过期，如果过期则清理删除
   * 如果 20 个样本中，超过 5 个 key 都过期，即过期比例大于 25%，就继续从该 DB 的 expire dict 过期字典中，再随机取样 20 个 key 进行过期清理，持续循环，直到选择的 20 个样本 key 中，过期的 key 数小于等于 5，当前这个 DB 则清理完毕，然后继续轮询下一个 DB



## 2. 淘汰方式





## 3. 淘汰策略

1. noeviction：
   * 不执行淘汰。内存超过阀值后，对所有写操作返回错误，但对读请求正常处理
   * 是 Redis 的默认策略
2. volatile-lru：
   * 淘汰对象：带过期时间的 key 